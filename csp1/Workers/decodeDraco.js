define(["./ComponentDatatype-4a60b8d6","./defaultValue-94c3e563","./IndexDatatype-db156785","./RuntimeError-c581ca93","./createTaskProcessorWorker","./WebGLConstants-7dccdc96"],(function(t,e,r,n,o,a){"use strict";let i;function s(t,e){const n=t.num_points(),o=t.num_faces(),a=new i.DracoInt32Array,s=3*o,c=r.IndexDatatype.createTypedArray(n,s);let u=0;for(let r=0;r<o;++r)e.GetFaceFromMesh(t,r,a),c[u+0]=a.GetValue(0),c[u+1]=a.GetValue(1),c[u+2]=a.GetValue(2),u+=3;return i.destroy(a),{typedArray:c,numberOfIndices:s}}function c(t,e,r,n,o){let a,s;n.quantizationBits<=8?(s=new i.DracoUInt8Array,a=new Uint8Array(o),e.GetAttributeUInt8ForAllPoints(t,r,s)):(s=new i.DracoUInt16Array,a=new Uint16Array(o),e.GetAttributeUInt16ForAllPoints(t,r,s));for(let i=0;i<o;++i)a[i]=s.GetValue(i);return i.destroy(s),a}function u(t,e,r,n){let o,a;switch(r.data_type()){case 1:case 11:a=new i.DracoInt8Array,o=new Int8Array(n),e.GetAttributeInt8ForAllPoints(t,r,a);break;case 2:a=new i.DracoUInt8Array,o=new Uint8Array(n),e.GetAttributeUInt8ForAllPoints(t,r,a);break;case 3:a=new i.DracoInt16Array,o=new Int16Array(n),e.GetAttributeInt16ForAllPoints(t,r,a);break;case 4:a=new i.DracoUInt16Array,o=new Uint16Array(n),e.GetAttributeUInt16ForAllPoints(t,r,a);break;case 5:case 7:a=new i.DracoInt32Array,o=new Int32Array(n),e.GetAttributeInt32ForAllPoints(t,r,a);break;case 6:case 8:a=new i.DracoUInt32Array,o=new Uint32Array(n),e.GetAttributeUInt32ForAllPoints(t,r,a);break;case 9:case 10:a=new i.DracoFloat32Array,o=new Float32Array(n),e.GetAttributeFloatForAllPoints(t,r,a);break}for(let i=0;i<n;++i)o[i]=a.GetValue(i);return i.destroy(a),o}function d(r,n,o){const a=r.num_points(),s=o.num_components();let d,f=new i.AttributeQuantizationTransform;if(f.InitFromAttribute(o)){const t=new Array(s);for(let e=0;e<s;++e)t[e]=f.min_value(e);d={quantizationBits:f.quantization_bits(),minValues:t,range:f.range(),octEncoded:!1}}i.destroy(f),f=new i.AttributeOctahedronTransform,f.InitFromAttribute(o)&&(d={quantizationBits:f.quantization_bits(),octEncoded:!0}),i.destroy(f);const y=a*s;let A;A=e.defined(d)?c(r,n,o,d,y):u(r,n,o,y);const l=t.ComponentDatatype.fromTypedArray(A);return{array:A,data:{componentsPerAttribute:s,componentDatatype:l,byteOffset:o.byte_offset(),byteStride:t.ComponentDatatype.getSizeInBytes(l)*s,normalized:o.normalized(),quantization:d}}}function f(t){const e=new i.Decoder;t.dequantizeInShader&&(e.SkipAttributeTransform(i.POSITION),e.SkipAttributeTransform(i.NORMAL));const r=new i.DecoderBuffer;r.Init(t.buffer,t.buffer.length);const o=e.GetEncodedGeometryType(r);if(o!==i.POINT_CLOUD)throw new n.RuntimeError("Draco geometry type must be POINT_CLOUD.");const a=new i.PointCloud,s=e.DecodeBufferToPointCloud(r,a);if(!s.ok()||0===a.ptr)throw new n.RuntimeError(`Error decoding draco point cloud: ${s.error_msg()}`);i.destroy(r);const c={},u=t.properties;for(const n in u)if(u.hasOwnProperty(n)){let t;if("POSITION"===n||"NORMAL"===n){const r=e.GetAttributeId(a,i[n]);t=e.GetAttribute(a,r)}else{const r=u[n];t=e.GetAttributeByUniqueId(a,r)}c[n]=d(a,e,t)}return i.destroy(a),i.destroy(e),c}function y(t){const e=new i.Decoder,r=["POSITION","NORMAL","COLOR","TEX_COORD"];if(t.dequantizeInShader)for(let n=0;n<r.length;++n)e.SkipAttributeTransform(i[r[n]]);const o=t.bufferView,a=new i.DecoderBuffer;a.Init(t.array,o.byteLength);const c=e.GetEncodedGeometryType(a);if(c!==i.TRIANGULAR_MESH)throw new n.RuntimeError("Unsupported draco mesh geometry type.");const u=new i.Mesh,f=e.DecodeBufferToMesh(a,u);if(!f.ok()||0===u.ptr)throw new n.RuntimeError(`Error decoding draco mesh geometry: ${f.error_msg()}`);i.destroy(a);const y={},A=t.compressedAttributes;for(const n in A)if(A.hasOwnProperty(n)){const t=A[n],r=e.GetAttributeByUniqueId(u,t);y[n]=d(u,e,r)}const l={indexArray:s(u,e),attributeData:y};return i.destroy(u),i.destroy(e),l}function A(t){return e.defined(t.bufferView)?y(t):f(t)}function l(t){i=t,self.onmessage=o(A),self.postMessage(!0)}function b(t){const r=t.data,n=r.webAssemblyConfig;if(e.defined(n))return require([n.modulePath],(function(t){e.defined(n.wasmBinaryFile)?(e.defined(t)||(t=self.DracoDecoderModule),t(n).then((function(t){l(t)}))):l(t())}))}return b}));